<!DOCTYPE html>
<html>
<head>
    <title>NFT Stars Battle</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://telegram.org/js/telegram-web-app.js">
        // –í–Ω—É—Ç—Ä–∏ setup() Vue 3:
const tg = window.Telegram.WebApp;
const user_id = tg.initDataUnsafe.user?.id || 123; // –î–ª—è —Ç–µ—Å—Ç–∞

// –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
async function fetchUser() {
    const response = await fetch(`http://localhost:8000/user/${user_id}`);
    if (!response.ok) throw new Error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö");
    const data = await response.json();
    balance.value = data.balance;
}

// –ü–æ–ª—É—á–∏—Ç—å –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
async function fetchInventory() {
    const response = await fetch(`http://localhost:8000/inventory/${user_id}`);
    inventory.value = await response.json();
}

// –ö—É–ø–∏—Ç—å –∫–µ–π—Å
async function openCase(type) {
    await fetch('/buy_case', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ user_id })
    });
    await fetchUser();
}

// –ü—Ä–æ–¥–∞—Ç—å –ø—Ä–µ–¥–º–µ—Ç
async function sellItem(item) {
    await fetch('/sell_item', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ user_id, item })
    });
    await fetchUser();
    await fetchInventory();
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
onMounted(async () => {
    await fetchUser();
    await fetchInventory();
});
    </script>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            background: #1e1e2e;
            color: white;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 100%;
            padding: 10px;
        }
        .case {
            background: #2e2e3e;
            border-radius: 15px;
            padding: 15px;
            margin: 10px 0;
            text-align: center;
        }
        .case-image {
            width: 150px;
            height: 150px;
            margin: 0 auto;
            background: #3e3e4e;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 50px;
        }
        .battle-area {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
        }
        .player-area {
            width: 48%;
            background: #2e2e3e;
            border-radius: 15px;
            padding: 10px;
            text-align: center;
        }
        button {
            background: #5a67d8;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            font-weight: bold;
            margin: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container" id="app">
        <h1>NFT Stars Battle</h1>
        
        <div v-if="view === 'main'">
            <div class="balance">–ë–∞–ª–∞–Ω—Å: {{ balance }} üíé</div>
            
            <button @click="switchView('battle')">üéÆ –ù–∞—á–∞—Ç—å –±–∞—Ç—Ç–ª</button>
            <button @click="switchView('shop')">üõçÔ∏è –ú–∞–≥–∞–∑–∏–Ω –∫–µ–π—Å–æ–≤</button>
            <button @click="switchView('inventory')">üéí –ú–æ–π –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å</button>
        </div>
        
        <div v-if="view === 'shop'">
            <h2>–ú–∞–≥–∞–∑–∏–Ω –∫–µ–π—Å–æ–≤</h2>
            
            <div class="case" @click="openCase('stars')">
                <div class="case-image">üåü</div>
                <h3>–ö–µ–π—Å –∑–≤–µ–∑–¥ Telegram</h3>
                <p>500 üíé</p>
                <button>–ö—É–ø–∏—Ç—å</button>
            </div>
            
            <div class="case" @click="openCase('nft')">
                <div class="case-image">üñºÔ∏è</div>
                <h3>NFT –∫–µ–π—Å</h3>
                <p>750 üíé</p>
                <button>–ö—É–ø–∏—Ç—å</button>
            </div>
            
            <button @click="switchView('main')">–ù–∞–∑–∞–¥</button>
        </div>
        
        <div v-if="view === 'battle'">
            <h2>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º –±–∞—Ç—Ç–ª–∞</h2>
            
            <button @click="startBattle('1v1')">1 vs 1</button>
            <button @click="startBattle('tournament')">–¢—É—Ä–Ω–∏—Ä (5 –∏–≥—Ä–æ–∫–æ–≤)</button>
            
            <div v-if="battleActive" class="battle-area">
                <div class="player-area">
                    <h3>–í—ã</h3>
                    <div v-if="yourReward">
                        <div class="case-image">{{ yourReward.emoji }}</div>
                        <p>{{ yourReward.name }}</p>
                        <p>–†–µ–¥–∫–æ—Å—Ç—å: {{ yourReward.rarity }}</p>
                    </div>
                    <button v-else @click="openCase('battle')">–û—Ç–∫—Ä—ã—Ç—å –∫–µ–π—Å</button>
                </div>
                
                <div class="player-area">
                    <h3>–û–ø–ø–æ–Ω–µ–Ω—Ç</h3>
                    <div v-if="opponentReward">
                        <div class="case-image">{{ opponentReward.emoji }}</div>
                        <p>{{ opponentReward.name }}</p>
                        <p>–†–µ–¥–∫–æ—Å—Ç—å: {{ opponentReward.rarity }}</p>
                    </div>
                    <div v-else>–û–∂–∏–¥–∞–Ω–∏–µ...</div>
                </div>
            </div>
            
            <button @click="switchView('main')">–ù–∞–∑–∞–¥</button>
        </div>
        
        <div v-if="view === 'inventory'">
            <h2>–ú–æ–π –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å</h2>
            
            <div v-for="item in inventory" class="case">
                <div class="case-image">{{ item.emoji }}</div>
                <h3>{{ item.name }}</h3>
                <p>–†–µ–¥–∫–æ—Å—Ç—å: {{ item.rarity }}</p>
                <button @click="sellItem(item)">–ü—Ä–æ–¥–∞—Ç—å ({{ item.price }} üíé)</button>
            </div>
            
            <button @click="switchView('main')">–ù–∞–∑–∞–¥</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.js"></script>
    <script>
        const { createApp, ref } = Vue;
        
        createApp({
            setup() {
                const view = ref('main');
                const balance = ref(1000);
                const inventory = ref([]);
                const battleActive = ref(false);
                const yourReward = ref(null);
                const opponentReward = ref(null);
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
                const tg = window.Telegram.WebApp;
                tg.expand();
                tg.BackButton.onClick(() => {
                    if (view.value !== 'main') {
                        view.value = 'main';
                        tg.BackButton.hide();
                    }
                });
                
                function switchView(newView) {
                    view.value = newView;
                    if (newView !== 'main') {
                        tg.BackButton.show();
                    } else {
                        tg.BackButton.hide();
                    }
                }
                
                function openCase(type) {
                    // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ –±—ç–∫–µ–Ω–¥—É
                    const cases = {
                        stars: [
                            { emoji: 'üåü', name: '–ö–∞—Ä—Ç–æ—á–∫–∞ –î—É—Ä–æ–≤–∞', rarity: '–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–∞—è', price: 2000 },
                            { emoji: 'üåü', name: '–ò–≤–∞–Ω –ì–ª—É—à–∫–æ–≤', rarity: '–†–µ–¥–∫–∞—è', price: 800 }
                        ],
                        nft: [
                            { emoji: 'üñºÔ∏è', name: '–ó–æ–ª–æ—Ç–æ–π —Å—Ç–∏–∫–µ—Ä', rarity: '–≠–ø–∏—á–µ—Å–∫–∞—è', price: 1500 }
                        ]
                    };
                    
                    const reward = cases[type][Math.floor(Math.random() * cases[type].length)];
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å –∏ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
                    const casePrices = { stars: 500, nft: 750 };
                    balance.value -= casePrices[type];
                    inventory.value.push(reward);
                    
                    // –ï—Å–ª–∏ —ç—Ç–æ –±–∞—Ç—Ç–ª - —Å–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞–≥—Ä–∞–¥—É
                    if (view.value === 'battle') {
                        yourReward.value = reward;
                        // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –±–∞—Ç—Ç–ª–∞
                    } else {
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ø–∞–ø —Å –≤—ã–∏–≥—Ä—ã—à–µ–º
                        tg.showPopup({
                            title: '–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!',
                            message: `–í—ã –ø–æ–ª—É—á–∏–ª–∏: ${reward.name} (${reward.rarity})`,
                            buttons: [{ type: 'close' }]
                        });
                    }
                }
                
                function startBattle(type) {
                    battleActive.value = true;
                    yourReward.value = null;
                    opponentReward.value = null;
                    
                    // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ matchmaking
                }
                
                function sellItem(item) {
                    balance.value += item.price;
                    inventory.value = inventory.value.filter(i => i !== item);
                }
                
                return {
                    view,
                    balance,
                    inventory,
                    battleActive,
                    yourReward,
                    opponentReward,
                    switchView,
                    openCase,
                    startBattle,
                    sellItem
                };
            }
        }).mount('#app');
    </script>
</body>
</html>